<div data-controller="filter" class="mb-6">
  <button
    type="button"
    data-action="click->filter#toggle"
    data-filter-target="button"
    aria-expanded="false"
    class="flex items-center gap-2 bg-white border border-gray-300 rounded-lg px-4 py-2 hover:bg-gray-50 transition mb-4 cursor-pointer">
    <%= image_tag "icons/filter.svg", class: "w-5 h-5", alt: "", "aria-hidden": "true" %>
    <span class="font-medium">Filters</span>
    <svg data-filter-target="icon" class="w-4 h-4 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
    </svg>
  </button>

  <div data-filter-target="panel" class="hidden">
    <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
      <%= form_with url: reviews_path, method: :get,
                                      data: { turbo_frame: "reviews", turbo_action: "advance" },
                                      class: "space-y-6" do |f| %>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-3">Rating</label>
              <div class="space-y-2">
                <% (1..5).to_a.reverse.each do |rating| %>
                  <label class="flex items-center hover:bg-gray-50 p-2 rounded cursor-pointer">
                    <%= check_box_tag 'ratings[]', rating, params[:ratings]&.include?(rating.to_s),
                        class: "mr-2 rounded text-purple-600" %>
                    <span class="text-sm text-gray-700"><%= rating_stars(rating) %></span>
                  </label>
                <% end %>
              </div>
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-3">Channel</label>
              <div class="space-y-2">
                <% @channels.each do |channel| %>
                  <label class="flex items-center hover:bg-gray-50 p-2 rounded cursor-pointer">
                    <%= check_box_tag 'channels[]', channel, params[:channels]&.include?(channel),
                        class: "mr-2 rounded text-purple-600" %>
                    <span class="text-sm text-gray-700"><%= channel %></span>
                  </label>
                <% end %>
              </div>
            </div>
          </div>

          <div class="space-y-4">

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Company Name</label>
              <%= text_field_tag :company_name, params[:company_name],
                  placeholder: "Search by company...",
                  class: "w-full px-4 py-2 border border-gray-300 rounded-lg" %>
            </div>


            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Date Range</label>
              <div class="grid grid-cols-2 gap-3">
                <div>
                  <label for="start_date" class="block text-xs text-gray-600 mb-1">Start Date</label>
                  <%= date_field_tag :start_date, params[:start_date],
                      class: "w-full px-4 py-2 border border-gray-300 rounded-lg" %>
                </div>
                <div>
                  <label for="end_date" class="block text-xs text-gray-600 mb-1">End Date</label>
                  <%= date_field_tag :end_date, params[:end_date],
                      class: "w-full px-4 py-2 border border-gray-300 rounded-lg" %>
                </div>
              </div>
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Search Description</label>
              <%= text_field_tag :query, params[:query],
                  placeholder: "Search reviews...",
                  class: "w-full px-4 py-2 border border-gray-300 rounded-lg" %>
            </div>
          </div>
        </div>

        <div class="flex gap-3 pt-4 border-t">
          <%= submit_tag "Apply Filters",
              class: "bg-indigo-300 text-white px-6 py-2 rounded-lg hover:bg-indigo-400 transition font-medium" %>
          <%= link_to "Clear All", reviews_path,
              class: "bg-gray-100 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-200 transition font-medium" %>
        </div>

      <% end %>
    </div>
  </div>
</div>
